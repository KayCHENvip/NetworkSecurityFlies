***黑客工具之 whatweb 详细使用教程***

**一、**whatweb 简介

**WhatWeb**是一个开源的网站指纹识别软件。

**WhatWeb**可识别Web技术，包括内容管理系统（CMS），博客平台，统计/分析包，Javascript库，服务器和嵌入式设备。

**whatweb** 是 kali 中网站指纹识别的工具，使用 Ruby 语言开发。whatweb 可识别 web 技术，包括内容管理系统 (CMS)、博客平台、统计 / 分析包、JavaScript 库，Web 服务器和嵌入式设备等。它有超过 900 个插件，每个插件都能识别不同的东西。Whatweb 还可以识别版本号，电子邮件地址、账户 ID、Web 框架模块，SQL 错误等。

**工具文章合集：**

[黑客老鸟 - 九青：一文教你学会黑客必备安全工具，轻松入门](https://zhuanlan.zhihu.com/p/401413938)

WhatWeb 可以隐秘、快速、彻底或缓慢扫描。WhatWeb 支持攻击级别来控制速度和可靠性之间的权衡。当在浏览器中访问网站时，该交易包含许多关于 Web 技术为该网站提供支持的提示。有时，单个网页访问包含足够的信息来识别网站，但如果没有，WhatWeb 可以进一步询问网站。默认的攻击级别称为 “被动”，速度最快，只需要一个网站的 HTTP 请求。这适用于扫描公共网站。在渗透测试中开发了更积极的模式。

用法： **weatweb 域名**

- -i 指定要扫描的文件
- -v 详细显示扫描的结果
- -a 指定运行级别

## 二、特性

- 拥有超过 1700 + 个插件
- 若网站返回 302，会跳转到重定向的网站
- 可以根据服务器返回的响应头确定网站使用的服务器类型，web 中间件类型，cookie 信息
- 可以从网站的源代码中确定网站使用了哪些 JavaScript 库
- 可以通过页面 hash，path 等确定网站使用的 cms 版本
- 查询网站 ip 及所属国家
- 多种日志格式：XML，JSON，MagicTree，RubyObject，MongoDB
- 可定制化 HTTP 头
- 可进行基础的认证设置
- 支持批量扫描网站

## 三、安装

## 安装

Whatweb 是基于 ruby 语言开发，因此可以安装在具备 ruby 环境的系统中，目前支持 Windows/Max OSX/Linux。

*注：kali linux 下已经集成了此工具*

debian/ubtuntu 系统下

```
apt-get install whatweb  //可自动解决以来问题
```

redhat/centos 系统下

```
yum update
yum install ruby ruby-devel rubygems
wget http://www.morningstarsecurity.com/downloads/whatweb-0.4.7.tar.gz
tar xzvf whatweb-0.4.7.tar.gz
cd whatweb-0.4.7
./whatweb url
```

## 四、常规扫描

whatweb 域名

![img](https://pic4.zhimg.com/v2-7690469ca911b4d5aae752cbda447a1f_r.jpg)

## 五、批量扫描

我们可以通过将很多要扫描的域名放在文件内，然后扫描时指定该文件即可。

![img](https://pic3.zhimg.com/v2-a4bdcd77f3e44a08343cf5cb1669579e_b.jpg)

使用命令：whatweb -i /root/target.txt

![img](https://pic2.zhimg.com/v2-54bfce4ec801c3f3c9b7b4df6faf6939_r.jpg)

## 六、详细回显扫描

whatweb -v 域名

![img](https://pic3.zhimg.com/v2-6d31ab2c2f66c843c5d7c898de6b45d6_r.jpg)

![img](https://pic3.zhimg.com/v2-a310d51006050435056fb2b73cafd932_r.jpg)

## 七、强度扫描等级控制

whatweb 有一个 - aggression（简写为 - a）参数，此参数后边可以跟数字 1-4，分别对应 4 个不同的等级。

1. stealthy 每个目标发送一次 http 请求，并且会跟随重定向
2. unused 不可用（从 2011 年开始，此参数就是在开发状态
3. aggressive 每个目标发送少量的 http 请求，这些请求时根据参数为 1 时结果确定的
4. heavy 每个目标会发送大量的 http 请求，会去尝试每一个插件

whatweb -a 等级 域名 （可以和 - v 参数结合使用

![img](https://pic4.zhimg.com/v2-176d8a0e37c02a09a65e85eeb44abf27_r.jpg)

注：默认参数为 1

## 八、快速本地扫描（扫描内网主机）

whatweb --no-errors -t 255 内网网段 （可以和 - a 和 - v 参数结合使用

![img](https://pic4.zhimg.com/v2-7e7fd30d8114cfe88f34e6f2cc550383_r.jpg)

## 九、将扫描结果导出至文件内

whatweb [http://www.baidu.com](http://www.baidu.com/) --log-xml=baidu.xml

![img](https://pic3.zhimg.com/v2-632b962041b05d63018a937525b3c4c2_r.jpg)

![img](https://pic4.zhimg.com/v2-226b31d472f98726995fc5d99720778b_r.jpg)

其他格式导出文件同理：

```
--log-brief=FILE            简单的记录，每个网站只记录一条返回信息
--log-verbose=FILE            详细输出
--log-xml=FILE            返回xml格式的日志
--log-json=FILE            以json格式记录日志
--log-json-verbose=FILE            记录详细的json日志
--log-magictree=FILE            xml的树形结构
--log-object=FILE            ruby对象格式
--log-mongo-database            mongo数据库格式
```

注：json 格式需要安装 json 依赖 sudo gem install json

Mongo 格式需要安装 mongo 依赖 sudo gem install json

## 十、列出所有插件

whatweb -l

![img](https://pic3.zhimg.com/v2-5c2d40803b3b28adbd9393846f91132e_r.jpg)

查看插件的具体信息

whatweb --info-plugins="插件名"

插件的开发语言为 ruby，所以插件为. rb 格式，插件的保存目录为 / usr/share/whatweb/plugins，可以查看别人是怎么写插件的。

## 十一、编写 whatweb 插件

whatweb 对国内的网站识别不是很友好，我们可以自己写插件，兼容更多国内的网站。

whatweb 的官方模板：

```
Plugin.define "Plugin-Template" do
    author "Enter Your Name"
    version "0.1"
    description "Describe what the plugin identifies. Include the homepage of the software package"
    examples %w| include-some.net example-websites.com here.com |
 
    \# a comment block here is a good place to make notes for yourself and others 
 
    \# There are four types of matches: regexp, text, ghdb 
    \# Matches are enclosed in {} brackets and separated by commas 
    matches [
    {:name=>"a brief description of the match, eg. powered by in footer",
    :certainty=>100, # 100 is certain, 75 is probably and 25 is maybe. if omitted, it defaults to 100. 
    :regexp=>/This page was generated by http://www.genericcms.com\/en\/products\/generic-cms\/">Generic CMS<\/a>/ },
 
    {:name=>"title",
    :certainty=>75,
    :text=>"<title>Generic Homepage</title>" }
    ]
    end
```

语法解释：

第一行定义的为插件的名字，可以直接在命令行中使用。

命令行测试：

```
./whatweb -p drupal www.example.com
```

第二行作者，第三行版本，第四行插件描述，第五行，插件所使用网站的例子

第五行是一个 matchs 列表，也是 whatweb 的关键，里边定义了一些匹配规则

{:name=>”meta generator tag”, : 包含匹配的文件名称，这个文件必须是网站中唯一存在的文件。

:regexp=> 是包含的要匹配的模式，它是一个正则表达式，可以有以下选项：

```
:regexp标准的 ruby 正则表达式
:text 字符
:ghdb google hack 数据库，包含以下几个模式
inurl:包含的字符串在 url
intitle:包含的字符串在 title
filetype:包含的文件名，如 PDF, JPG, RB 等
:md5 请求页面的 md5 hash 值
:tagpattern html 标签
:version 可以设置正则表达式或直接字符串匹配
:string 可以设置正则表达式或直接字符串匹配
:filepath 可以设置正则表达式或直接字符串匹配，通常显示系统错误或配置文件等
:account 经常用在登陆页面或用户列表等
:module 可以设置正则表达式或直接字符串匹配，如网络设备可能使用了一个ruby 模块等
:model 可以设置正则表达式或直接字符串匹配
:firmware 可以设置正则表达式或直接字符串匹配，设备的固件版本
```

了解以上选项我们可以写出一个简单的识别 dedecms 的插件，如下

```
Plugin.define "DedeCMS" do
author "xxxxx"
version "0.1"
description "dedecms - homepage:http://www.dedecms.com/"
 
# Examples # 
examples %w|
www.dedecms.com|
 
matches [
 
# Version detection # Powered by text 
{:name=>"Powered by DedeCms",
:regexp=>/Powered by .*DedeCMS.*/}
]
end
```

如图所示：

![img](https://pic2.zhimg.com/v2-0a946d3fab646fc4018e62e2edeb1c8d_r.jpg)